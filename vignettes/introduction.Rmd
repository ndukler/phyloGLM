---
title: "Introduction to phyloGLM"
author: "Noah Dukler"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

First create some data and a tree. Pretend that sites are split into two classes, "Enhancer" and "Promoter" and also split by ontology classes "A" and "B".

```{r}
library(phyloGLM)
## Set seed for consistency
set.seed(123)
## Set some parameters for the simulation
species=c("A","B","C","D","E")
nAlleles=3
nSites=5000

## Create test trees, both one that will fail, and one that will pass
tree=ape::rtree(n = length(species),tip.label = species)

## Create a covariate data.frame with labels
siteLabels=data.frame(cre.class=factor(rep(c("Enhancer","Promoter"),times=c(3/4*nSites,1/4*nSites))),
                      logXpress = rnorm(n = nSites, mean = 0 , sd = 1))
## Set the rate parameter formula
rateFormula = formula(~cre.class+logXpress+0)
## Set parameter values
rateParams=matrix(c(-0.1,-0.4,-0.3),nrow=1)
piParams=matrix(c(0.3,0.1,0,0,-0.1,0.5),nrow=2,ncol=3,byrow = T)
## Simulate data
aData=simulateSites(tr=tree,covariateTable = siteLabels,rateFormula = rateFormula, rateParams = rateParams,
                    piParams = piParams)
```
Now create the allele data object:

```{r,echo=FALSE}
ad=alleleData(data=aData$data,tree=tree,siteInfo = siteLabels)
```

Now create a rate model specifying that genomic regions should be seperated by both cre.class and go.class.

```{r}
rateMod=rateModel(data = ad,rateFormula=rateFormula)
```

Now we can fit the model:

```{r}
fitted_status=fit(rateMod,threads=3)
```

Once fitted we can extract the parameters and their standard errors and plot them:

```{r}
seTab=se(rateMod)
plotParams(seTab)
```

